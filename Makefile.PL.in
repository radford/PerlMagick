use ExtUtils::MakeMaker;
# See lib/ExtUtils/MakeMaker.pm for details of how to influence
# the contents of the Makefile that is written.
WriteMakefile(
    'NAME'	=> 'Image::Magick',
    'VERSION_FROM' => 'Magick.pm', # finds $VERSION
    'LIBS'	=> ['@LDFLAGS@ @MAGICKLIB@ @X11STUBSLIB@ @LIBS@'],
    'DEFINE'	=> '',     # e.g., '-DHAVE_SOMETHING' 
    'INC'	=> '-I@top_srcdir@/magick @CPPFLAGS@',
);

#
# Modify the MakeMaker test fragment
#
sub MY::test
{
   #
   # List any ImageMagick features derived from add-on libraries
   # or programs you would like to test.
   #
   # Valid choices are: IM fpx hdf jbig jpeg mpeg png ps tiff ttf zlib x xfig
   #
   # e.g. my @PLUGINS = qw/jpeg tiff/;
   #
   my @PLUGINS = qw/IM @PLUGINS@/;

   package MY; # so that "SUPER" works right
   my $inherited = shift->SUPER::test(@_);
   my $plugintests='';
   my $plugin;
   foreach $plugin (@PLUGINS) {
     if( -d "t/$plugin" ) {
       $plugintests .= " t/$plugin/*.t";
    }
   }
   $inherited =~ s:^TEST_FILES =.*:TEST_FILES = t/*.t ${plugintests}:m;
   $inherited;
}

